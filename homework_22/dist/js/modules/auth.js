import{hideProtectedElements,showProtectedElements}from"../utils/domAuthUtils.js";import{hideElement,showElement}from"../utils/domUtils.js";import{clearToken,isLoggedIn,setAuthToken}from"../utils/utils.js";const MIN_PASS_LENGTH=6,emailRegex=/^[a-z0-9._%+-]{3,}@[a-z0-9.-]+\.[a-z]{2,4}$/,submit=document.querySelector("#submit"),emailInput=document.querySelector("#email"),passwordInput=document.querySelector("#password"),emailDisclaimer=document.querySelector("#emailDisclaimer"),emailError=document.querySelector("#emailError"),passwordDisclaimer=document.querySelector("#passwordDisclaimer"),passwordError=document.querySelector("#passwordError"),noSuchUserMessage=document.querySelector("#noSuchUserMessage"),form=document.querySelector("#form"),logoutBtn=document.querySelector("#logout"),showPage=()=>{showProtectedElements(),hideElement(form)},hidePage=()=>{clearToken(),hideProtectedElements(),showElement(form)},handleSuccessAuth=e=>{setAuthToken(e),showPage()},handleError=e=>{"user not found"===e?noSuchUserMessage.style.display="block":"Missing password"===e&&(passwordError.style.display="block")},clearErrors=(e,r)=>{e.classList.add("hidden"),r.classList.add("visible"),r.classList.remove("hidden")},handleErrors=(e,r,s)=>{s?(e.classList.add("hidden"),e.classList.remove("visible"),r.classList.remove("hidden")):(e.classList.add("visible"),e.classList.remove("hidden"),r.classList.add("hidden"))},setButtonDisabled=e=>{submit.disabled=!!e},login=(emailInput.addEventListener("blur",e=>{e=emailRegex.test(e.target.value);handleErrors(emailError,emailDisclaimer,e)}),passwordInput.addEventListener("blur",e=>{e=e.target.value.length>=MIN_PASS_LENGTH;handleErrors(passwordError,passwordDisclaimer,e)}),passwordInput.addEventListener("input",()=>{clearErrors(passwordError,passwordDisclaimer)}),emailInput.addEventListener("input",()=>{clearErrors(emailError,emailDisclaimer)}),form.addEventListener("input",()=>{var e=!passwordInput.value||!emailInput.value;setButtonDisabled(e),noSuchUserMessage.classList.add("hidden")}),async e=>{try{var r=await(await fetch("https://reqres.in/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:e})).json();r.token&&handleSuccessAuth(r.token),r.error&&handleError(r.error)}catch(e){console.error(e)}});window.addEventListener("load",()=>{isLoggedIn()&&showPage()}),form.addEventListener("submit",e=>{e.preventDefault();var r=[emailError,passwordError].some(e=>e.classList.contains("visible"));if(!r){r=new FormData(e.target);const s={};r.forEach((e,r)=>{s[r]=e}),login(JSON.stringify(s)),form.reset()}}),logoutBtn.addEventListener("click",hidePage);