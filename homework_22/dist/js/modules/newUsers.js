import{hideElement,showElement}from"../utils/domUtils.js";import{getAuthToken}from"../utils/utils.js";const userForm=document.getElementById("userForm"),editUserForm=document.getElementById("editUserForm"),userIdError=document.getElementById("userIdError"),idField=document.getElementById("userId"),newUsersList=document.getElementById("newUsersList");let newUsers=[];const authToken=getAuthToken(),removeUserEl=t=>{showNewUsers(newUsers=newUsers.filter(({id:e})=>e!==t),newUsersList)},editUserElement=(e,t)=>{var r=newUsers.findIndex(({id:e})=>+e==+t);if(-1===!r)return console.error("no such user to edit");newUsers[r]=e,showNewUsers(newUsers,newUsersList)};function showNewUsers(e,o){o.innerHTML="",e.forEach(e=>{var t=document.createElement("p"),r=(t.innerText=`${e.first_name} ${e.last_name} id: `+e.id,document.createElement("img")),s=(r.src=e.avatar,document.createElement("button")),n=(s.innerText="Delete",s.id="deleteUserBtn",s.onclick=()=>{deleteUser(e.id)},document.createElement("div"));n.classList.add("userCard"),n.append(t,r,s),o.appendChild(n)})}idField.addEventListener("change",()=>{hideElement(userIdError)}),editUserForm.addEventListener("submit",e=>{e.preventDefault();e=new FormData(e.target);const r={};e.forEach((e,t)=>r[t]=e),newUsers.some(({id:e})=>r.id===e)?(editUser(JSON.stringify(r),r.id),editUserForm.reset()):showElement(userIdError)}),userForm.addEventListener("submit",e=>{e.preventDefault();e=new FormData(e.target);const r={};e.forEach((e,t)=>r[t]=e),createUser(JSON.stringify(r)),userForm.reset()});const editUser=async(e,t)=>{try{var r=await(await fetch("https://reqres.in/api/users/"+t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+authToken},body:e})).json();editUserElement(r,t)}catch(e){console.error(e)}},createUser=async e=>{try{var t=await(await fetch("https://reqres.in/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+authToken},body:e})).json();newUsers.push(t),showNewUsers(newUsers,newUsersList)}catch(e){console.error(e)}},deleteUser=async e=>{try{await fetch("https://reqres.in/api/users/"+e,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:authToken}}),removeUserEl(e)}catch(e){console.log(e)}};