import{hideProtectedElements,showProtectedElements}from"../utils/domAuthUtils.js";import{hideElement,showElement}from"../utils/domUtils.js";import{clearToken,isLoggedIn,setAuthToken}from"../utils/utils.js";const MIN_PASS_LENGTH=6,emailRegex=/^[a-z0-9._%+-]{3,}@[a-z0-9.-]+\.[a-z]{2,4}$/,submit=document.querySelector("#submit"),emailInput=document.querySelector("#email"),passwordInput=document.querySelector("#password"),emailDisclaimer=document.querySelector("#emailDisclaimer"),emailError=document.querySelector("#emailError"),passwordDisclaimer=document.querySelector("#passwordDisclaimer"),passwordError=document.querySelector("#passwordError"),noSuchUserMessage=document.querySelector("#noSuchUserMessage"),form=document.querySelector("#form"),logoutBtn=document.querySelector("#logout"),showPage=()=>{showProtectedElements(),hideElement(form)},hidePage=()=>{clearToken(),hideProtectedElements(),showElement(form)},handleSuccessAuth=e=>{setAuthToken(e),showPage()},handleError=e=>{"user not found"===e?noSuchUserMessage.style.display="block":"Missing password"===e&&(passwordError.style.display="block")},clearErrors=(e,r)=>{e.classList.add("hidden"),r.classList.add("visible"),r.classList.remove("hidden")},handleErrors=(e,r,s)=>{s?(e.classList.add("hidden"),e.classList.remove("visible"),r.classList.remove("hidden")):(e.classList.add("visible"),e.classList.remove("hidden"),r.classList.add("hidden"))},setButtonDisabled=e=>{submit.disabled=!!e},login=(emailInput.addEventListener("blur",e=>{e=emailRegex.test(e.target.value);handleErrors(emailError,emailDisclaimer,e)}),passwordInput.addEventListener("blur",e=>{e=e.target.value.length>=MIN_PASS_LENGTH;handleErrors(passwordError,passwordDisclaimer,e)}),passwordInput.addEventListener("input",()=>{clearErrors(passwordError,passwordDisclaimer)}),emailInput.addEventListener("input",()=>{clearErrors(emailError,emailDisclaimer)}),form.addEventListener("input",()=>{var e=!passwordInput.value||!emailInput.value;setButtonDisabled(e),noSuchUserMessage.classList.add("hidden")}),async e=>{try{var r=await(await fetch("https://reqres.in/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:e})).json();r.token&&handleSuccessAuth(r.token),r.error&&handleError(r.error)}catch(e){console.error(e)}});window.addEventListener("load",()=>{isLoggedIn()&&showPage()}),form.addEventListener("submit",e=>{e.preventDefault();var r=[emailError,passwordError].some(e=>e.classList.contains("visible"));if(!r){r=new FormData(e.target);const s={};r.forEach((e,r)=>{s[r]=e}),login(JSON.stringify(s)),form.reset()}}),logoutBtn.addEventListener("click",hidePage);
import{hideElement,showElement}from"../utils/domUtils.js";import{getAuthToken}from"../utils/utils.js";const userForm=document.getElementById("userForm"),editUserForm=document.getElementById("editUserForm"),userIdError=document.getElementById("userIdError"),idField=document.getElementById("userId"),newUsersList=document.getElementById("newUsersList");let newUsers=[];const authToken=getAuthToken(),removeUserEl=t=>{showNewUsers(newUsers=newUsers.filter(({id:e})=>e!==t),newUsersList)},editUserElement=(e,t)=>{var r=newUsers.findIndex(({id:e})=>+e==+t);if(-1===!r)return console.error("no such user to edit");newUsers[r]=e,showNewUsers(newUsers,newUsersList)};function showNewUsers(e,o){o.innerHTML="",e.forEach(e=>{var t=document.createElement("p"),r=(t.innerText=`${e.first_name} ${e.last_name} id: `+e.id,document.createElement("img")),s=(r.src=e.avatar,document.createElement("button")),n=(s.innerText="Delete",s.id="deleteUserBtn",s.onclick=()=>{deleteUser(e.id)},document.createElement("div"));n.classList.add("userCard"),n.append(t,r,s),o.appendChild(n)})}idField.addEventListener("change",()=>{hideElement(userIdError)}),editUserForm.addEventListener("submit",e=>{e.preventDefault();e=new FormData(e.target);const r={};e.forEach((e,t)=>r[t]=e),newUsers.some(({id:e})=>r.id===e)?(editUser(JSON.stringify(r),r.id),editUserForm.reset()):showElement(userIdError)}),userForm.addEventListener("submit",e=>{e.preventDefault();e=new FormData(e.target);const r={};e.forEach((e,t)=>r[t]=e),createUser(JSON.stringify(r)),userForm.reset()});const editUser=async(e,t)=>{try{var r=await(await fetch("https://reqres.in/api/users/"+t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+authToken},body:e})).json();editUserElement(r,t)}catch(e){console.error(e)}},createUser=async e=>{try{var t=await(await fetch("https://reqres.in/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+authToken},body:e})).json();newUsers.push(t),showNewUsers(newUsers,newUsersList)}catch(e){console.error(e)}},deleteUser=async e=>{try{await fetch("https://reqres.in/api/users/"+e,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:authToken}}),removeUserEl(e)}catch(e){console.log(e)}};
const usersList=document.getElementById("usersList"),prevButton=document.getElementById("prev"),nextButton=document.getElementById("next");let pageNumber=1;function showUsers(e,s){s.innerHTML="",e.forEach(e=>{var t=document.createElement("p"),n=(t.innerText=e.first_name+" "+e.last_name,document.createElement("img")),e=(n.src=e.avatar,document.createElement("div"));e.append(t,n),s.appendChild(e)})}const updateControls=e=>{pageNumber===e?(nextButton.disabled=!0,prevButton.disabled=!1):1===pageNumber&&(prevButton.disabled=!0,nextButton.disabled=!1)},getUsers=async e=>{try{var t=await(await fetch("https://reqres.in/api/users?page="+e)).json();showUsers(t.data,usersList),updateControls(t.total_pages)}catch(e){console.error(e)}};getUsers(pageNumber),nextButton.addEventListener("click",()=>{getUsers(++pageNumber)}),prevButton.addEventListener("click",()=>{getUsers(--pageNumber)});
import{showElement,hideElement}from"./domUtils.js";const userListContainer=document.getElementById("usersListContainer"),forms=document.getElementById("formContainer"),showProtectedElements=()=>{showElement(forms),showElement(userListContainer)},hideProtectedElements=()=>{hideElement(forms),hideElement(userListContainer)};console.log("hello");export{showProtectedElements,hideProtectedElements};
const hideElement=e=>{e.style.display="none"},showElement=e=>{e.style.display="flex"};export{hideElement,showElement};
const getAuthToken=()=>localStorage.getItem("authToken"),isLoggedIn=()=>{return!!getAuthToken()},setAuthToken=e=>{e&&localStorage.setItem("authToken",e)},clearToken=()=>{localStorage.removeItem("authToken")};export{getAuthToken,isLoggedIn,setAuthToken,clearToken};